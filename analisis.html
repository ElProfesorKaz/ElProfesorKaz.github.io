<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Calidad IA</title>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #fafafa; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #262626; }
        .container { background: white; border: 1px solid #dbdbdb; padding: 30px; border-radius: 3px; max-width: 500px; width: 100%; text-align: center; }
        h1 { font-size: 24px; margin-bottom: 10px; }
        p { color: #8e8e8e; margin-bottom: 30px; }
        
        /* Bot√≥n de subida personalizado */
        .upload-btn-wrapper { position: relative; overflow: hidden; display: inline-block; margin-bottom: 20px;}
        .btn { border: 1px solid #dbdbdb; color: #262626; background-color: white; padding: 10px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .upload-btn-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; width: 100%; }

        #loading { display: none; color: #0095f6; font-weight: bold; margin: 20px 0; }
        
        /* Secci√≥n de resultados (El susto) */
        #results { display: none; border-top: 2px solid #ff3b30; margin-top: 20px; padding-top: 20px; text-align: left;}
        .hacker-title { color: #ff3b30; font-weight: bold; font-size: 1.2em; margin-bottom: 15px; text-align: center; text-transform: uppercase; }
        .data-item { margin-bottom: 10px; font-family: monospace; }
        .label { font-weight: bold; color: #555; }
        #map-link { display: block; background: #34c759; color: white; text-align: center; padding: 15px; border-radius: 10px; text-decoration: none; font-weight: bold; margin-top: 20px; }
        .no-gps { background: #eee; padding: 15px; border-radius: 10px; text-align: center; margin-top: 20px; font-size: 0.9em; color: #555;}
    </style>
</head>
<body>

    <div class="container">
        <h1>Analizador de Calidad</h1>
        <p>Sube tu foto para verificar si cumple los est√°ndares de alta resoluci√≥n del algoritmo.</p>
        
        <div class="upload-btn-wrapper">
          <button class="btn">Seleccionar foto de la Galer√≠a</button>
          <input type="file" id="fileInput" accept="image/jpeg, image/png, image/heic" />
        </div>

        <div id="loading">Analizando metadatos ocultos...</div>

        <div id="results">
            <div class="hacker-title">‚ö†Ô∏è DATOS EXTRA√çDOS DE LA FOTO ‚ö†Ô∏è</div>
            
            <div class="data-item"><span class="label">Dispositivo:</span> <span id="model">---</span></div>
            <div class="data-item"><span class="label">Fecha exacta:</span> <span id="date">---</span></div>

            <div id="gps-container"></div>
        </div>
    </div>

    <script>
        // Escuchar cuando el usuario elige una foto
        document.getElementById('fileInput').addEventListener('change', function() {
            const file = this.files[0];
            if (!file) return;

            // Mostrar carga
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            // Usar la librer√≠a EXIF.js para leer el archivo localmente
            EXIF.getData(file, function() {
                const model = EXIF.getTag(this, "Model") || "Desconocido";
                const date = EXIF.getTag(this, "DateTimeOriginal") || "Desconocida";
                
                // Datos b√°sicos
                document.getElementById('model').innerText = model;
                document.getElementById('date').innerText = date;

                // LA PARTE IMPORTANTE: Latitud y Longitud GPS
                const latArray = EXIF.getTag(this, "GPSLatitude");
                const lonArray = EXIF.getTag(this, "GPSLongitude");
                const latRef = EXIF.getTag(this, "GPSLatitudeRef") || "N";
                const lonRef = EXIF.getTag(this, "GPSLongitudeRef") || "E";

                const gpsContainer = document.getElementById('gps-container');
                gpsContainer.innerHTML = ''; // Limpiar anterior

                if (latArray && lonArray) {
                    // Convertir el formato raro de EXIF a decimales para Google Maps
                    const lat = convertDMSToDD(latArray[0], latArray[1], latArray[2], latRef);
                    const lon = convertDMSToDD(lonArray[0], lonArray[1], lonArray[2], lonRef);

                    // Crear el enlace a Google Maps
                    gpsContainer.innerHTML = `
                        <a id="map-link" href="https://www.google.com/maps?q=${lat},${lon}" target="_blank">
                            üìç ¬°VER UBICACI√ìN EXACTA EN EL MAPA!
                        </a>
                        <p style="text-align:center; font-size:0.8em; margin-top:5px;">(Si esto fuera la casa de tu crush, ya sabr√≠a d√≥nde vive)</p>
                    `;
                } else {
                    // Si no hay GPS (ej: captura de pantalla o foto de WhatsApp)
                    gpsContainer.innerHTML = `
                        <div class="no-gps">
                            ‚úÖ <strong>Foto limpia de GPS.</strong><br>
                            (Probablemente es una captura de pantalla, o te la pasaron por WhatsApp/Instagram, que borran estos datos).
                        </div>
                    `;
                }

                // Mostrar resultados final
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('results').style.display = 'block';
                }, 1000);
            });
        });

        // Funci√≥n auxiliar matem√°tica para convertir coordenadas (no hace falta que la expliques)
        function convertDMSToDD(degrees, minutes, seconds, direction) {
            let dd = degrees + minutes / 60 + seconds / (60 * 60);
            if (direction == "S" || direction == "W") { dd = dd * -1; }
            return dd;
        }
    </script>
</body>
</html>
